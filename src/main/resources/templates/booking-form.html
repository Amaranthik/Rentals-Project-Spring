<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background-color: #f3f4f6; font-family: system-ui, -apple-system, sans-serif; }
    .card { border: none; border-radius: 16px; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
    .form-label { font-weight: 600; color: #374151; margin-bottom: 8px; font-size: 0.95rem; }
    .form-control, .form-select { border-radius: 8px; padding: 12px 16px; border: 1px solid #d1d5db; }
    .form-control:focus { border-color: #2563eb; box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.1); }
    .btn-dark { background-color: #1f2937; border-radius: 8px; padding: 12px 32px; font-weight: 600; }
    .btn-outline-secondary { border-radius: 8px; padding: 12px 24px; }
  </style>
</head>
<body>
<nav class="navbar navbar-dark bg-dark mb-5">
  <div class="container">
    <a class="navbar-brand fw-bold" href="/properties">üè† RENTALS SYSTEM</a>
  </div>
</nav>

<div class="container">
  <div class="row justify-content-center">
    <div class="col-lg-7">
      <div class="card bg-white p-5">
        <div class="mb-4 pb-3 border-bottom d-flex justify-content-between align-items-center">
          <div>
            <h2 class="fw-bold text-dark m-0">–î–æ–≥–æ–≤–æ—Ä –∞—Ä–µ–Ω–¥—ã</h2>
            <p class="text-muted mb-0">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —É—Å–ª–æ–≤–∏—è —Å–¥–µ–ª–∫–∏</p>
          </div>
          <div class="text-end">
            <span class="d-block text-muted small">–û–ë–™–ï–ö–¢</span>
            <strong class="text-primary" th:text="${property.title}"></strong>
          </div>
        </div>

        <form th:action="@{/bookings/save}" th:object="${booking}" method="post" id="bookingForm">
          <input type="hidden" name="property" th:value="${property.id}" />

          <div class="mb-4">
            <label class="form-label">–ê—Ä–µ–Ω–¥–∞—Ç–æ—Ä</label>
            <select th:field="*{tenant}" class="form-select" required>
              <option th:each="u : ${users}" th:value="${u.id}" th:text="${u.fullName}"></option>
            </select>
          </div>

          <div class="row mb-4">
            <div class="col-6">
              <label class="form-label">–î–∞—Ç–∞ –∑–∞–µ–∑–¥–∞</label>
              <!-- –î–æ–±–∞–≤–∏–ª–∏ max="2100-12-31" -->
              <input type="date" th:field="*{startDate}" id="startDate" class="form-control" max="2100-12-31" required />
            </div>
            <div class="col-6">
              <label class="form-label">–î–∞—Ç–∞ –≤—ã–µ–∑–¥–∞</label>
              <!-- –î–æ–±–∞–≤–∏–ª–∏ max="2100-12-31" -->
              <input type="date" th:field="*{endDate}" id="endDate" class="form-control" max="2100-12-31" required />
            </div>
          </div>

          <div class="mb-4 bg-light p-3 rounded-3">
            <label class="form-label text-uppercase small text-muted">–°—É–º–º–∞ –¥–æ–≥–æ–≤–æ—Ä–∞ (–†—É–±)</label>
            <input type="number" step="100" min="0" th:field="*{totalPrice}" class="form-control border-0 bg-white shadow-sm" placeholder="0" style="font-size: 1.2rem; font-weight: bold;" />
            <div class="form-text mt-2">–í–∫–ª—é—á–∞—è –¥–µ–ø–æ–∑–∏—Ç. –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞–≥–µ–Ω—Ç–æ–º.</div>
          </div>

          <div class="d-flex justify-content-end gap-3 mt-4">
            <a href="/properties" class="btn btn-outline-secondary">–û—Ç–º–µ–Ω–∞</a>
            <button type="submit" class="btn btn-dark">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —Å–¥–µ–ª–∫—É</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
  const form = document.getElementById('bookingForm');
  const startInput = document.getElementById('startDate');
  const endInput = document.getElementById('endDate');

  startInput.addEventListener('change', function() {
    endInput.min = this.value;
  });

  form.addEventListener('submit', function(e) {
    const start = new Date(startInput.value);
    const end = new Date(endInput.value);
    const maxDate = new Date('2100-12-31');

    if (start > maxDate || end > maxDate) {
      e.preventDefault();
      alert('–û—à–∏–±–∫–∞! –£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≥–æ–¥ (–¥–æ 2100).');
      return;
    }

    if (end < start) {
      e.preventDefault();
      alert('–û—à–∏–±–∫–∞! –î–∞—Ç–∞ –≤—ã–µ–∑–¥–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–∞–Ω—å—à–µ –¥–∞—Ç—ã –∑–∞–µ–∑–¥–∞.');
    }
  });
</script>
</body>
</html>